---
// Import the Image component and helper
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

// Define the props for the component
interface Props {
  slug: string;
  alt: string;
  class?: string;
}

const { slug, alt, class: className = "w-12 h-12" } = Astro.props;

// Import ALL images from the products directory
const allImages = import.meta.glob<{ default: ImageMetadata }>(
  "/src/content/products/images/**/*.{png,jpg,JPG,jpeg,gif,webp}"
);

// Find the first image for this product slug
let productImage: ImageMetadata | null = null;

if (slug) {
  // Filter images for the specific subdirectory
  const filteredImagePaths = Object.entries(allImages)
    .filter(([path]) => {
      const subDirPath = `/src/content/products/images/${slug}/`;
      return path.startsWith(subDirPath);
    });

  if (filteredImagePaths.length > 0) {
    // Get the first image
    const [, loader] = filteredImagePaths[0];
    try {
      const imageModule = await loader();
      productImage = imageModule.default;
    } catch (error) {
      console.error('Error loading product image:', error);
    }
  }
}
---

<div class={`avatar ${className}`}>
  <div class="mask mask-squircle w-12 h-12">
    {productImage ? (
      <Image
        src={productImage}
        alt={alt}
        width={48}
        height={48}
        class="object-cover"
      />
    ) : (
      <div class="w-full h-full bg-base-300 flex items-center justify-center">
        <svg class="w-6 h-6 text-base-content/50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
          <circle cx="9" cy="9" r="2" />
          <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
        </svg>
      </div>
    )}
  </div>
</div>