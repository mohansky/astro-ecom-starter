---
import Layout from '@/layouts/Layout.astro';
import ProfileLayout from '@/layouts/ProfileLayout.astro';
import Container from '@/components/ui/Container.astro';
import Heading from '@/components/ui/Heading.astro';
import Paragraph from '@/components/ui/Paragraph.astro';
import { ProfileSettingsForm } from '@/components/Admin/ProfileSettingsForm';
import { getUser } from '@/lib/auth-utils';

const user = await getUser(Astro);

if (!user) {
  return Astro.redirect('/admin/login');
}

if (!user.emailVerified) {
  return Astro.redirect('/emailVerification');
}

const r2BucketUrl = import.meta.env.R2_BUCKET_URL;
---

<Layout title="Profile Settings">
  <ProfileLayout>
    <Container width="marginy">
      <div class="max-w-4xl mt-20 lg:mt-0 mx-auto">
        <div class="mb-8">
          <Heading size="xl" class="mb-2">Profile Settings</Heading>
          <Paragraph class="opacity-70"
            >Manage your account information and security settings</Paragraph
          >
        </div>

        <ProfileSettingsForm client:only="react" userId={user.id} r2BucketUrl={r2BucketUrl} />
      </div>
    </Container>
  </ProfileLayout>
</Layout>
