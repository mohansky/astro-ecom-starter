---
import Container from '@/components/ui/Container.astro';
import Layout from '@/layouts/Layout.astro';
import ProfileLayout from '@/layouts/ProfileLayout.astro';
import { UsersDataTable } from '@/components/Admin/UsersDataTable';
import { requireAdminAuth } from '@/lib/auth-utils';
import AdminBreadcrumbs from '@/components/Admin/AdminBreadcrumbs.astro';

const authResult = await requireAdminAuth(Astro);
if (authResult instanceof Response) {
  return authResult;
}

// Get R2 bucket URL for avatar images
const R2_BUCKET_URL = import.meta.env.R2_BUCKET_URL;
---

<Layout title="Manobal | User Management">
  <ProfileLayout>
    <Container width="marginy">
      <AdminBreadcrumbs
        items={[{ label: 'Users' }]}
        pageTitle="User Management"
        pageDescription="Manage user accounts and permissions"
      />
      <div class="card bg-base-100 shadow-sm w-full">
        <div class="card-body">
          <UsersDataTable client:load r2BucketUrl={R2_BUCKET_URL} />
        </div>
      </div>
    </Container>
  </ProfileLayout>
</Layout>
